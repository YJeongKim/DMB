# âœ’ 2020ë…„ 5ì›” 25ì¼ ì›”ìš”ì¼

<br>

## ğŸ’«ğŸ’¬ğŸ’¡

###### `#ì¼ìƒ` `#Errorì™€ ì‹¸ì›€`

ì£¼ë§ ë‚´ë‚´ ë°¤ ìƒˆì›Œ ê³¼ì œì™€ í”„ë¡œì íŠ¸ì™€ ì‹¸ìš°ë‹¤ ì˜¤ëŠ˜ì€ ê²°êµ­ 30ë¶„ ë°–ì— ëª»ìê³  í•™êµë¡œ ì¶œê·¼í•˜ì˜€ë‹¤. <br>
6ì‹œì— ì˜ê¹Œ ë§ê¹Œ ê³ ë¯¼í•˜ë‹¤ ì ê¹ ëˆˆë§Œ ë¶™ì˜€ë‹¤ê°€ ë–¼ì—ˆë‹¤. <br>
í•™êµì—ì„œ ê³µë¶€ ë§ì´ í•˜ë ¤í–ˆëŠ”ë° ê³µë¶€ëŠ” ë¬´ìŠ¨.. <br>
ì¼ì´ ë„ˆë¬´ ë°”ë¹ ì„œ ì¼ë§Œ ì”ëœ©í•˜ëŠë¼ ë…¸íŠ¸ë¶ì„ íŒŒìš°ì¹˜ì—ì„œ êº¼ë‚´ì§€ë„ ëª»í–ˆë‹¤.ğŸ˜¥ <br>
ì„ ìƒë‹˜ë“¤ì´ ìœ ë… ë‚˜ì—ê²Œ ì—…ë¬´ë¥¼ ë§¡ê¸°ì‹ ë‹¤. ì¢€ ëœ ì—´ì‹¬íˆ í•  ê±¸ ê·¸ë¬ë‹¤. <br>
í•™êµ êµì§ì›ì„ í•˜ë¼ëŠ” ìŠ¤ì¹´ì›ƒ ì œì˜ê¹Œì§€ í•˜ì…¨ì§€ë§Œ ë‚˜ëŠ” ê°œë°œì í• ë˜ìš”~~~ <br>
ì¼ ëë‚˜ê³  ì¡¸ì—…ì‘í’ˆìœ¼ë¡œ ì¤€ë¹„í•˜ëŠ” í”„ë¡œì íŠ¸ë¥¼ ê±´ë“¤ì˜€ëŠ”ë° êµ¬ê¸€ë¡œê·¸ì¸... ë‚  ë¯¸ì¹˜ê²Œ í•œë‹¤. <br>
ì•„ì£¼ ì‹ ëª…ë‚˜ê²Œ ì˜¤ë¥˜ë¥¼ íŒ¡íŒ¡ í„°ëœ¨ë¦°ë‹¤^^.. ì–¼ë¥¸ ì´ ì˜¤ë¥˜ë¥¼ ì ì¬ìš°ê³  í•´ê²°í•œ ë°©ë²•ì„ ê¸°ë¡í•˜ê²Œ í•´ì£¼ì„¸ìš” ã…ˆã…‚

<img src="https://user-images.githubusercontent.com/33328991/82824203-de25b780-9ee3-11ea-8e44-d299e19c4a3f.png" />

...

ã…ã…ã…... ë¯¼ì„±ì˜¤ë¹ ì—ê²Œ í–‰ì•„ì›ƒìœ¼ë¡œ ì°¡ì°¡ëŒ€ìë§ˆì 1ë¶„ë„ ì•ˆë˜ì„œ ì›ì¸ì„ ë‚´ ëˆˆìœ¼ë¡œ ì°¾ì•„ë²„ë ¸ë‹¤......ã… <br>
ì´ê·¸!!! ë©ì²­ì´...!!ã…  <br>
ErrorëŠ” êµ¬ê¸€ ë¡œê·¸ì¸ì„ ì‹œë„í•  ë•Œ í„°ì¡Œìœ¼ë©°, ë‹¤ìŒ ì‚¬ì§„ê³¼ ê°™ì€ ì˜¤ë¥˜ í˜ì´ì§€ë¡œ ì´ë™í•˜ë©° ìœ„ì˜ Errorë¥¼ íŒ¡íŒ¡í„°ëœ¨ë¦¬ì§€ë§Œ <br>
ë’¤ë¡œ ëŒì•„ê°€ë©´ ë¡œê·¸ì¸ì´ ë˜ì–´ìˆìœ¼ë©° Test DBì—ë„ ì €ì¥ì´ ì •ìƒì ìœ¼ë¡œ ë˜ì–´ìˆëŠ” í˜„ìƒì´ ì¼ì–´ë‚¬ì—ˆë‹¤.

![image](https://user-images.githubusercontent.com/33328991/82826921-f4824200-9ee8-11ea-9f7b-fe83d82e4160.png)

í•µì‹¬ Error MessageëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
```java
java.lang.IllegalArgumentException: attributes cannot be empty
   at org.springframework.util.Assert.notEmpty(Assert.java:508) ~[spring-core-5.1.9.RELEASE.jar:5.1.9.RELEASE]
   at org.springframework.security.oauth2.core.user.DefaultOAuth2User.<init>(DefaultOAuth2User.java:64) ~[spring-security-oauth2-core-5.1.6.RELEASE.jar:5.1.6.RELEASE]
   at space.yjeong.config.auth.CustomOAuth2UserService.loadUser(CustomOAuth2UserService.java:43) ~[main/:na]
   at org.springframework.security.oauth2.client.authentication.OAuth2LoginAuthenticationProvider.authenticate(OAuth2LoginAuthenticationProvider.java:116) ~[spring-security-oauth2-client-5.1.6.RELEASE.jar:5.1.6.RELEASE]
```
ì—¬ê¸° Error Messageì—ì„œëŠ” `attributes cannot be empty`ë¼ê³  ì—„ì²­ë‚œ íŒíŠ¸ë¥¼ ì£¼ì—ˆì§€ë§Œ, <br>
ë°”ë³´ê°™ì€ ë‚˜ëŠ” ë‹¤ë¥¸ ì½”ë“œì—ì„œ ì‚½ì§ˆì„ í•˜ê³ ìˆì—ˆë‹¤..
```java
public class CustomOAuth2UserService implements OAuth2UserService<OAuth2UserRequest, OAuth2User> {
    private final UserRepository userRepository;
    private final HttpSession httpSession;

    @Override
    public OAuth2User loadUser(OAuth2UserRequest userRequest) throws OAuth2AuthenticationException {
        ...

        OAuthAttributes attributes = OAuthAttributes.of(registrationId, userNameAttributeName, oAuth2User.getAttributes());

        ...
        
        return new DefaultOAuth2User(
                Collections.singleton(new SimpleGrantedAuthority(user.getRoleKey())),
                attributes.getAttributes(),
                attributes.getNameAttributeKey());
    }
```
ë¨¼ì € ë¬¸ì œì˜ `CustomOAuth2UserService` í´ë˜ìŠ¤ì˜ 43 Lineì¸ `attributes.getNameAttributeKey());`ë¥¼ ë³´ë©´ <br>
ì—¬ê¸°ì„œ `attributes`ëŠ” `OAuthAttributes`ì´ë‹¤. ì´ í´ë˜ìŠ¤ë¥¼ ì‚´í´ë³´ë©´ of() ë©”ì„œë“œëŠ” ofGoogle() ë©”ì„œë“œë¥¼ ë¦¬í„´í•˜ê³  ìˆë‹¤.
```java
@Getter
public class OAuthAttributes {
    private Map<String, Object> attributes;
    private String nameAttributeKey;
    private String name;
    private String email;
    private String picture;

    @Builder
    public OAuthAttributes(Map<String, Object> attributes, String nameAttributeKey, String name, String email, String picture) {
        this.attributes = attributes;
        this.nameAttributeKey = nameAttributeKey;
        this.name = name;
        this.email = email;
        this.picture = picture;
    }

    public static OAuthAttributes of(String registrationId, String userNameAttributeName, Map<String, Object> attributes) {
        return ofGoogle(userNameAttributeName, attributes);
    }

    private static OAuthAttributes ofGoogle(String userNameAttributeName, Map<String, Object> attributes) {
        return OAuthAttributes.builder()
                .name((String) attributes.get("name"))
                .email((String) attributes.get("email"))
                .picture((String) attributes.get("picture"))
                .attributes(attributes)
                .nameAttributeKey(userNameAttributeName)
                .build();
    }
    ...
}
```
ê·¸ëŸ°ë° ë‚˜ëŠ” ì—¬ê¸°ì„œ ë©ì²­í•˜ê²Œ `Map<String, Object> attributes` ì´ í•„ë“œë¥¼ í•¨ê»˜ ë¹Œë“œí•˜ì§€ ì•Šì•˜ë‹¤. <br>
```java
 private static OAuthAttributes ofGoogle(String userNameAttributeName, Map<String, Object> attributes) {
        return OAuthAttributes.builder()
                .name((String) attributes.get("name"))
                .email((String) attributes.get("email"))
                .picture((String) attributes.get("picture"))
                // attributesê°€ ëˆ„ë½ë˜ì—ˆë‹¤.
                .nameAttributeKey(userNameAttributeName)
                .build();
    }
```
ì´ëŸ° ê¹œì°í•œ ì‹¤ìˆ˜ë¡œ ì˜¤ëŠ˜ë„ ë‚˜ëŠ” ëª‡ ì‹œê°„ì„ ì‚½ì§ˆí•˜ì˜€ë‹¤. ì»´í“¨í„°ëŠ” ì •ë§ ì •ì§í•˜ë‹¤^^! <br>
ì•ìœ¼ë¡œ ì´ëŸ° ì‹¤ìˆ˜ë¥¼ í•˜ì§€ ì•Šë„ë¡ ì½”ë“œë¥¼ ë” ê¼¼ê¼¼íˆ ë´ì•¼ê² ë‹¤. (ì°¡ê¸‹-)

<img src="https://thumbs.gfycat.com/ImpureSinfulFlounder-size_restricted.gif" />

<br>

## ğŸ¯ğŸ“ŒğŸ“š

###### `#SpringBoot` `#SpringSecurity`

###### [ì˜¤ëŠ˜ì˜ íšŒê³ ] - ë‚´ ë‘ë‡Œ ERROR-ì‚ìµ--

### âœ” ì¡¸ì—… ì‘í’ˆ í”„ë¡œì íŠ¸

- í”„ë¡œì íŠ¸ ê°œë°œ ì§„í–‰
